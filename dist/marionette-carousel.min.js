var Carousel=Carousel||{};!function(){"use strict";var a=Mn.Application.extend({setRootLayout:function(){this.root=new Carousel.RootLayout}});Carousel.App=new a,Carousel.App.on("before:start",function(){Carousel.App.setRootLayout()})}();var Carousel=Carousel||{};!function(){"use strict";Carousel.Item=Backbone.Model.extend({defaults:{title:"",images:[],randomImage:"",visible:!1},initialize:function(){},isVisible:function(){return this.get("visible")}}),Carousel.Collection=Backbone.Collection.extend({model:Carousel.Item,url:"data/carousel.json",parse:function(a){var b=[];try{b=JSON.parse(a);for(var c=0,d=b.length;c<d;c++){var e=b[c].images,f=Math.floor(Math.random()*Math.floor(e.length));b[c].randomImage=e[f],b[c].visible=c<4}}catch(a){console.log("Error parsing carousel data."),console.error(a)}return b}})}();var Carousel=Carousel||{};!function(){"use strict";Carousel.RootLayout=Mn.View.extend({el:"#carouselApp",regions:{main:"#main"}})}();var Carousel=Carousel||{};!function(){"use strict";Carousel.ItemView=Mn.View.extend({tagName:"li",template:"#template-carouselItemView",onEditFocusout:function(){var a=this.ui.edit.val().trim();a?(this.model.set("title",a).save(),this.$el.removeClass("editing")):this.destroy()}}),Carousel.ListViewBody=Mn.CollectionView.extend({tagName:"ul",id:"carousel-list",childView:Carousel.ItemView,index:0,size:4,filter:function(a,b){return b>=this.index&&b<this.index+this.size},left:function(){var a=this;if(this.index>0){this.index--;var b=new $.Deferred,c=new $.Deferred;$("#carousel-list li:last").fadeOut("slow",function(){b.resolve()}),$("#carousel-list li").animate({left:"150px"},500,"swing",function(){c.resolve()}),$.when(b,c).then(function(){a.render()})}},right:function(){var a=this;if(this.index+this.size<this.collection.length){this.index++;var b=new $.Deferred,c=new $.Deferred;$("#carousel-list li:first").fadeOut("slow",function(){b.resolve()}),$("#carousel-list li").animate({left:"-150px"},500,"swing",function(){c.resolve()}),$.when(b,c).then(function(){a.render()})}},setSize:function(a){this.size=a}}),Carousel.ListView=Mn.View.extend({template:"#template-carouselListView",regions:{listBody:{el:"ul",replaceElement:!0}},ui:{left:"#rotateLeft",right:"#rotateRight"},events:{"click @ui.left":"rotateLeft","click @ui.right":"rotateRight","keydown @ui.carousel":"onEditKeypress"},rotateLeft:function(){this.listViewBody.left()},rotateRight:function(){this.listViewBody.right()},onKeyup:function(a){37===a.which?this.listViewBody.left():39===a.which&&this.listViewBody.right()},initialize:function(){console.log("initialize");var a=this;$(document).on("keyup",function(){a.onKeyup.apply(a,arguments)})},onRender:function(){this.listViewBody=new Carousel.ListViewBody({collection:this.collection}),this.showChildView("listBody",this.listViewBody)}})}();var Carousel=Carousel||{};!function(){"use strict";Carousel.Router=Mn.AppRouter.extend({appRoutes:{}}),Carousel.Controller=Mn.Object.extend({initialize:function(){this.carouselCollection=new Carousel.Collection},start:function(){this.showCarousel(this.carousel),this.carouselCollection.on("all",this.updateHiddenElements,this),this.carouselCollection.fetch({dataType:"text",success:function(){console.log("success fetching data")},error:function(){console.log("error fetching data"),console.error(arguments)}})},showCarousel:function(a){Carousel.App.root.showChildView("main",new Carousel.ListView({collection:this.carouselCollection}))}})}();var Carousel=Carousel||{};$(function(){"use strict";Carousel.App.on("start",function(){var a=new Carousel.Controller;a.router=new Carousel.Router({controller:a}),a.start(),Backbone.history.start()}),Carousel.App.start()});